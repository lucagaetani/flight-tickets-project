{
  "version": 3,
  "sources": ["../../src/associations/has-many.ts"],
  "sourcesContent": ["import isObject from 'lodash/isObject';\nimport upperFirst from 'lodash/upperFirst';\nimport type { WhereOptions } from '../dialects/abstract/where-sql-builder-types.js';\nimport { AssociationError } from '../errors/index.js';\nimport { col } from '../expression-builders/col.js';\nimport { fn } from '../expression-builders/fn.js';\nimport type {\n  AttributeNames,\n  Attributes,\n  CreateOptions,\n  CreationAttributes,\n  DestroyOptions,\n  Filterable,\n  FindOptions,\n  InstanceUpdateOptions,\n  Model,\n  ModelStatic,\n  Transactionable,\n  UpdateValues,\n} from '../model';\nimport { Op } from '../operators';\nimport { isPlainObject } from '../utils/check.js';\nimport { isSameInitialModel } from '../utils/model-utils.js';\nimport { removeUndefined } from '../utils/object.js';\nimport type { AllowIterable } from '../utils/types.js';\nimport { MultiAssociation } from './base';\nimport type { Association, AssociationOptions, MultiAssociationAccessors, MultiAssociationOptions } from './base';\nimport { BelongsTo } from './belongs-to.js';\nimport { defineAssociation, mixinMethods, normalizeBaseAssociationOptions } from './helpers';\nimport type { NormalizeBaseAssociationOptions } from './helpers';\n\n/**\n * One-to-many association.\n * See {@link Model.hasMany}\n *\n * Like with {@link HasOne}, the foreign key will be defined on the target model.\n *\n * In the API reference below, add the name of the association to the method, e.g. for `User.hasMany(Project)` the getter will be `user.getProjects()`.\n * If the association is aliased, use the alias instead, e.g. `User.hasMany(Project, { as: 'jobs' })` will be `user.getJobs()`.\n *\n * @typeParam S The model on which {@link Model.hasMany} has been called, on which the association methods will be added.\n * @typeParam T The model passed to {@link Model.hasMany}. This model will receive the Foreign Key attribute.\n * @typeParam SourceKey The name of the attribute that the foreign key in the target model will reference.\n * @typeParam TargetKey The name of the Foreign Key attribute on the Target model.\n * @typeParam TargetPrimaryKey The name of the Primary Key attribute of the Target model. Used by {@link HasManySetAssociationsMixin} & others.\n */\nexport class HasMany<\n  S extends Model = Model,\n  T extends Model = Model,\n  SourceKey extends AttributeNames<S> = any,\n  TargetKey extends AttributeNames<T> = any,\n  TargetPrimaryKey extends AttributeNames<T> = any,\n> extends MultiAssociation<S, T, TargetKey, TargetPrimaryKey, NormalizedHasManyOptions<SourceKey, TargetKey>> {\n  accessors: MultiAssociationAccessors;\n\n  get foreignKey(): TargetKey {\n    return this.inverse.foreignKey;\n  }\n\n  /**\n   * The column name of the foreign key (on the target model)\n   */\n  get identifierField(): string {\n    return this.inverse.identifierField;\n  }\n\n  /**\n   * The name of the attribute the foreign key points to.\n   *\n   * This key is on the Source Model.\n   * The {@link Association.foreignKey} is on the Target Model.\n   */\n  get sourceKey(): SourceKey {\n    return this.inverse.targetKey;\n  }\n\n  /**\n   * @deprecated use {@link sourceKey}\n   */\n  get sourceKeyAttribute(): SourceKey {\n    return this.sourceKey;\n  }\n\n  get sourceKeyField(): string {\n    return this.inverse.targetKeyField;\n  }\n\n  readonly inverse: BelongsTo<T, S, TargetKey, SourceKey>;\n\n  constructor(\n    secret: symbol,\n    source: ModelStatic<S>,\n    target: ModelStatic<T>,\n    options: NormalizedHasManyOptions<SourceKey, TargetKey>,\n    parent?: Association,\n    inverse?: BelongsTo<T, S, TargetKey, SourceKey>,\n  ) {\n    if (\n      options.sourceKey\n      && !source.getAttributes()[options.sourceKey]\n    ) {\n      throw new Error(`Unknown attribute \"${options.sourceKey}\" passed as sourceKey, define this attribute on model \"${source.name}\" first`);\n    }\n\n    if ('keyType' in options) {\n      throw new TypeError('Option \"keyType\" has been removed from the BelongsTo\\'s options. Set \"foreignKey.type\" instead.');\n    }\n\n    if ('through' in options) {\n      throw new Error('The \"through\" option is not available in hasMany. N:M associations are defined using belongsToMany instead.');\n    }\n\n    super(secret, source, target, options, parent);\n\n    this.inverse = inverse ?? BelongsTo.associate(secret, target, source, removeUndefined({\n      as: options.inverse?.as,\n      scope: options.inverse?.scope,\n      foreignKey: options.foreignKey,\n      targetKey: options.sourceKey,\n      foreignKeyConstraints: options.foreignKeyConstraints,\n      hooks: options.hooks,\n    }), this);\n\n    // Get singular and plural names\n    // try to uppercase the first letter, unless the model forbids it\n    const plural = upperFirst(this.options.name.plural);\n    const singular = upperFirst(this.options.name.singular);\n\n    this.accessors = {\n      get: `get${plural}`,\n      set: `set${plural}`,\n      addMultiple: `add${plural}`,\n      add: `add${singular}`,\n      create: `create${singular}`,\n      remove: `remove${singular}`,\n      removeMultiple: `remove${plural}`,\n      hasSingle: `has${singular}`,\n      hasAll: `has${plural}`,\n      count: `count${plural}`,\n    };\n\n    this.#mixin(source.prototype);\n  }\n\n  static associate<\n    S extends Model,\n    T extends Model,\n    SourceKey extends AttributeNames<S>,\n    TargetKey extends AttributeNames<T>,\n  >(\n    secret: symbol,\n    source: ModelStatic<S>,\n    target: ModelStatic<T>,\n    options: HasManyOptions<SourceKey, TargetKey> = {},\n    parent?: Association<any>,\n    inverse?: BelongsTo<T, S, TargetKey, SourceKey>,\n  ): HasMany<S, T, SourceKey, TargetKey> {\n\n    return defineAssociation<\n      HasMany<S, T, SourceKey, TargetKey>,\n      HasManyOptions<SourceKey, TargetKey>,\n      NormalizedHasManyOptions<SourceKey, TargetKey>\n    >(HasMany, source, target, options, parent, normalizeBaseAssociationOptions, normalizedOptions => {\n      // self-associations must always set their 'as' parameter\n      if (isSameInitialModel(source, target)\n        // use 'options' because this will always be set in 'newOptions'\n        && (!options.as || !options.inverse?.as || options.as === options.inverse.as)) {\n        throw new AssociationError('Both options \"as\" and \"inverse.as\" must be defined for hasMany self-associations, and their value must be different.');\n      }\n\n      return new HasMany(secret, source, target, normalizedOptions, parent, inverse);\n    });\n  }\n\n  #mixin(mixinTargetPrototype: Model) {\n    mixinMethods(\n      this,\n      mixinTargetPrototype,\n      ['get', 'count', 'hasSingle', 'hasAll', 'set', 'add', 'addMultiple', 'remove', 'removeMultiple', 'create'],\n      {\n        hasSingle: 'has',\n        hasAll: 'has',\n        addMultiple: 'add',\n        removeMultiple: 'remove',\n      },\n    );\n  }\n\n  /**\n   * Get everything currently associated with this, using an optional where clause.\n   *\n   * @param instances source instances\n   * @param options find options\n   */\n  async get(instances: S, options?: HasManyGetAssociationsMixinOptions<T>): Promise<T[]>;\n  async get(instances: S[], options?: HasManyGetAssociationsMixinOptions<T>): Promise<Map<any, T[]>>;\n  async get(instances: S | S[], options: HasManyGetAssociationsMixinOptions<T> = {}): Promise<T[] | Map<any, T[]>> {\n    let isManyMode = true;\n    if (!Array.isArray(instances)) {\n      isManyMode = false;\n      instances = [instances];\n    }\n\n    const findOptions: FindOptions = { ...options };\n\n    const where = Object.create(null);\n\n    // TODO: scopes should be combined using AND instance of overwriting.\n    if (this.scope) {\n      Object.assign(where, this.scope);\n    }\n\n    let values;\n    if (instances.length > 1) {\n      values = instances.map(instance => instance.get(this.sourceKey, { raw: true }));\n\n      if (findOptions.limit && instances.length > 1) {\n        findOptions.groupedLimit = {\n          limit: findOptions.limit,\n          on: this, // association\n          values,\n        };\n\n        delete findOptions.limit;\n      } else {\n        where[this.foreignKey] = {\n          [Op.in]: values,\n        };\n        delete findOptions.groupedLimit;\n      }\n    } else {\n      where[this.foreignKey] = instances[0].get(this.sourceKey, { raw: true });\n    }\n\n    findOptions.where = findOptions.where\n      ? { [Op.and]: [where, findOptions.where] }\n      : where;\n\n    let Model = this.target;\n    if (options.scope != null) {\n      if (!options.scope) {\n        Model = Model.withoutScope();\n      } else if (options.scope !== true) { // 'true' means default scope. Which is the same as not doing anything.\n        Model = Model.withScope(options.scope);\n      }\n    }\n\n    if (options.schema != null) {\n      Model = Model.withSchema({ schema: options.schema, schemaDelimiter: options.schemaDelimiter });\n    }\n\n    const results = await Model.findAll(findOptions);\n    if (!isManyMode) {\n      return results;\n    }\n\n    const result: Map<any, T[]> = new Map();\n    for (const instance of instances) {\n      result.set(instance.get(this.sourceKey, { raw: true }), []);\n    }\n\n    for (const instance of results) {\n      const value = instance.get(this.foreignKey, { raw: true });\n      result.get(value)!.push(instance);\n    }\n\n    return result;\n  }\n\n  /**\n   * Count everything currently associated with this, using an optional where clause.\n   *\n   * @param instance the source instance\n   * @param options find & count options\n   */\n  async count(instance: S, options?: HasManyCountAssociationsMixinOptions<T>): Promise<number> {\n    const findOptions: HasManyGetAssociationsMixinOptions<T> = {\n      ...options,\n      raw: true,\n      plain: true,\n      attributes: [\n        [\n          fn(\n            'COUNT',\n            col(`${this.target.name}.${this.target.primaryKeyField}`),\n          ),\n          'count',\n        ],\n      ],\n    };\n\n    const result = await this.get(instance, findOptions);\n\n    return Number.parseInt(\n      // @ts-expect-error -- this.get() isn't designed to expect returning a raw output.\n      result.count,\n      10,\n    );\n  }\n\n  /**\n   * Check if one or more rows are associated with `this`.\n   *\n   * @param sourceInstance the source instance\n   * @param targets A list of instances or their primary keys\n   * @param options Options passed to getAssociations\n   */\n  async has(\n    sourceInstance: S,\n    targets: AllowIterable<T | Exclude<T[TargetPrimaryKey], any[]>>,\n    options?: HasManyHasAssociationsMixinOptions<T>,\n  ): Promise<boolean> {\n    const normalizedTargets = this.toInstanceOrPkArray(targets);\n\n    const where = {\n      [Op.or]: normalizedTargets.map(instance => {\n        if (instance instanceof this.target) {\n          // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion -- needed for TS < 5.0\n          return (instance as T).where();\n        }\n\n        return {\n          // TODO: support composite foreign keys\n          // @ts-expect-error -- TODO: what if the target has no primary key?\n          [this.target.primaryKeyAttribute]: instance,\n        };\n      }),\n    };\n\n    const findOptions: HasManyGetAssociationsMixinOptions<T> = {\n      ...options,\n      scope: false,\n      // TODO: support composite foreign keys\n      // @ts-expect-error -- TODO: what if the target has no primary key?\n      attributes: [this.target.primaryKeyAttribute],\n      raw: true,\n      // @ts-expect-error -- TODO: current WhereOptions typings do not allow having 'WhereOptions' inside another 'WhereOptions'\n      where: {\n        [Op.and]: [\n          where,\n          options?.where,\n        ],\n      },\n    };\n\n    const associatedObjects = await this.get(sourceInstance, findOptions);\n\n    return associatedObjects.length === normalizedTargets.length;\n  }\n\n  /**\n   * Set the associated models by passing an array of persisted instances or their primary keys. Everything that is not in the passed array will be un-associated\n   *\n   * @param sourceInstance source instance to associate new instances with\n   * @param targets An array of persisted instances or primary key of instances to associate with this. Pass `null` to remove all associations.\n   * @param options Options passed to `target.findAll` and `update`.\n   */\n  async set(\n    sourceInstance: S,\n    targets: AllowIterable<T | Exclude<T[TargetPrimaryKey], any[]>> | null,\n    options?: HasManySetAssociationsMixinOptions<T>,\n  ): Promise<void> {\n    const normalizedTargets = this.toInstanceArray(targets);\n\n    const oldAssociations = await this.get(sourceInstance, { ...options, scope: false, raw: true });\n    const promises: Array<Promise<any>> = [];\n    const obsoleteAssociations = oldAssociations.filter(old => {\n      return !normalizedTargets.some(obj => {\n        // @ts-expect-error -- old is a raw result\n        return obj.get(this.target.primaryKeyAttribute) === old[this.target.primaryKeyAttribute];\n      });\n    });\n\n    const unassociatedObjects = normalizedTargets.filter(obj => {\n      return !oldAssociations.some(old => {\n        // @ts-expect-error -- old is a raw result\n        return obj.get(this.target.primaryKeyAttribute) === old[this.target.primaryKeyAttribute];\n      });\n    });\n\n    if (obsoleteAssociations.length > 0) {\n      promises.push(this.remove(sourceInstance, obsoleteAssociations, {\n        ...options,\n        destroy: options?.destroyPrevious,\n      }));\n    }\n\n    if (unassociatedObjects.length > 0) {\n      const update = {\n        [this.foreignKey]: sourceInstance.get(this.sourceKey),\n        ...this.scope,\n      } as UpdateValues<T>;\n\n      const updateWhere = {\n        // @ts-expect-error -- TODO: what if the target has no primary key?\n        [this.target.primaryKeyAttribute]: unassociatedObjects.map(unassociatedObject => {\n          // @ts-expect-error -- TODO: what if the target has no primary key?\n          return unassociatedObject.get(this.target.primaryKeyAttribute);\n        }),\n      };\n\n      promises.push(this.target.withoutScope().update(\n        update,\n        {\n          ...options,\n          where: updateWhere,\n        },\n      ));\n    }\n\n    await Promise.all(promises);\n  }\n\n  /**\n   * Associate one or more target rows with `this`. This method accepts a Model / string / number to associate a single row,\n   * or a mixed array of Model / string / numbers to associate multiple rows.\n   *\n   * @param sourceInstance the source instance\n   * @param [rawTargetInstances] A single instance or primary key, or a mixed array of persisted instances or primary keys\n   * @param [options] Options passed to `target.update`.\n   */\n  async add(\n    sourceInstance: S,\n    rawTargetInstances: AllowIterable<T | Exclude<T[TargetPrimaryKey], any[]>>,\n    options: HasManyAddAssociationsMixinOptions<T> = {},\n  ): Promise<void> {\n    const targetInstances = this.toInstanceArray(rawTargetInstances);\n\n    if (targetInstances.length === 0) {\n      return;\n    }\n\n    const update = {\n      [this.foreignKey]: sourceInstance.get(this.sourceKey),\n      ...this.scope,\n    } as UpdateValues<T>;\n\n    const where = {\n      // @ts-expect-error -- TODO: what if the target has no primary key?\n      [this.target.primaryKeyAttribute]: targetInstances.map(unassociatedObject => {\n        // @ts-expect-error -- TODO: what if the target has no primary key?\n        return unassociatedObject.get(this.target.primaryKeyAttribute);\n      }),\n    };\n\n    await this.target.withoutScope().update(update, { ...options, where });\n  }\n\n  /**\n   * Un-associate one or several target rows.\n   *\n   * @param sourceInstance instance to un associate instances with\n   * @param targets Can be an Instance or its primary key, or a mixed array of instances and primary keys\n   * @param options Options passed to `target.update`\n   */\n  async remove(\n    sourceInstance: S,\n    targets: AllowIterable<T | Exclude<T[TargetPrimaryKey], any[]>>,\n    options: HasManyRemoveAssociationsMixinOptions<T> = {},\n  ): Promise<void> {\n    if (targets == null) {\n      return;\n    }\n\n    const normalizedTargets = this.toInstanceOrPkArray(targets);\n    if (normalizedTargets.length === 0) {\n      return;\n    }\n\n    const where: WhereOptions = {\n      [this.foreignKey]: sourceInstance.get(this.sourceKey),\n      // @ts-expect-error -- TODO: what if the target has no primary key?\n      [this.target.primaryKeyAttribute]: normalizedTargets.map(targetInstance => {\n        if (targetInstance instanceof this.target) {\n          // @ts-expect-error -- TODO: what if the target has no primary key?\n          // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion -- needed for TS < 5.0\n          return (targetInstance as T).get(this.target.primaryKeyAttribute);\n        }\n\n        // raw entity\n        // @ts-expect-error -- TODO: what if the target has no primary key?\n        if (isPlainObject(targetInstance) && this.target.primaryKeyAttribute in targetInstance) {\n          // @ts-expect-error -- implicit any, can't be fixed\n          return targetInstance[this.target.primaryKeyAttribute];\n        }\n\n        // primary key\n        return targetInstance;\n      }),\n    };\n\n    const foreignKeyIsNullable = this.target.modelDefinition.attributes.get(this.foreignKey)?.allowNull ?? true;\n\n    if (options.destroy || !foreignKeyIsNullable) {\n      await this.target.withoutScope().destroy({\n        ...(isObject(options.destroy) ? options.destroy : undefined),\n        logging: options.logging,\n        benchmark: options.benchmark,\n        transaction: options.transaction,\n        where,\n      });\n    } else {\n      const update = {\n        [this.foreignKey]: null,\n      } as UpdateValues<T>;\n\n      await this.target.withoutScope().update(update, { ...options, where });\n    }\n  }\n\n  /**\n   * Create a new instance of the associated model and associate it with this.\n   *\n   * @param sourceInstance source instance\n   * @param values values for target model instance\n   * @param options Options passed to `target.create`\n   */\n  async create(\n    sourceInstance: S,\n    // @ts-expect-error -- {} is not always assignable to 'values', but Target.create will enforce this, not us.\n    values: CreationAttributes<T> = {},\n    options:\n      | HasManyCreateAssociationMixinOptions<T>\n      | HasManyCreateAssociationMixinOptions<T>['fields'] = {},\n  ): Promise<T> {\n    if (Array.isArray(options)) {\n      options = {\n        fields: options,\n      };\n    }\n\n    if (this.scope) {\n      for (const attribute of Object.keys(this.scope)) {\n        // @ts-expect-error -- TODO: fix the typing of {@link AssociationScope}\n        values[attribute] = this.scope[attribute];\n        if (options.fields) {\n          options.fields.push(attribute);\n        }\n      }\n    }\n\n    if (options.fields) {\n      options.fields.push(this.foreignKey);\n    }\n\n    return this.target.create({\n      ...values,\n      [this.foreignKey]: sourceInstance.get(this.sourceKey),\n    }, options);\n  }\n}\n\n// workaround https://github.com/evanw/esbuild/issues/1260\nObject.defineProperty(HasMany, 'name', {\n  value: 'HasMany',\n});\n\nexport type NormalizedHasManyOptions<SourceKey extends string, TargetKey extends string> =\n  NormalizeBaseAssociationOptions<HasManyOptions<SourceKey, TargetKey>>;\n\n/**\n * Options provided when associating models with hasMany relationship\n */\nexport interface HasManyOptions<SourceKey extends string, TargetKey extends string>\n  extends MultiAssociationOptions<TargetKey> {\n\n  /**\n   * The name of the field to use as the key for the association in the source table. Defaults to the primary\n   * key of the source table\n   */\n  sourceKey?: SourceKey;\n\n  inverse?: {\n    as?: AssociationOptions<any>['as'],\n    scope?: AssociationOptions<any>['scope'],\n  };\n}\n\n/**\n * The options for the getAssociations mixin of the hasMany association.\n *\n * Can provide an optional where clause to limit the associated models through {@link HasManyGetAssociationsMixinOptions.where}.\n *\n * @see HasManyGetAssociationsMixin\n */\nexport interface HasManyGetAssociationsMixinOptions<T extends Model> extends FindOptions<Attributes<T>> {\n  /**\n   * Apply a scope on the related model, or remove its default scope by passing false.\n   */\n  scope?: string | string[] | boolean;\n\n  /**\n   * Apply a schema on the related model\n   */\n  schema?: string;\n  schemaDelimiter?: string;\n}\n\n/**\n * The getAssociations mixin applied to models with hasMany.\n * An example of usage is as follows:\n *\n * ```typescript\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\n *   declare getRoles: HasManyGetAssociationsMixin<Role>;\n * }\n *\n * User.hasMany(Role);\n * ```\n *\n * @see Model.hasMany\n */\nexport type HasManyGetAssociationsMixin<T extends Model> = (options?: HasManyGetAssociationsMixinOptions<T>) => Promise<T[]>;\n\n/**\n * The options for the setAssociations mixin of the hasMany association.\n *\n * @see HasManySetAssociationsMixin\n */\nexport interface HasManySetAssociationsMixinOptions<T extends Model>\n  extends FindOptions<Attributes<T>>, InstanceUpdateOptions<Attributes<T>> {\n\n  /**\n   * Delete the previous associated model. Default to false.\n   *\n   * Only applies if the foreign key is nullable. If the foreign key is not nullable,\n   * the previous associated model is always deleted.\n   */\n  destroyPrevious?: boolean | Omit<DestroyOptions<Attributes<T>>, 'where' | 'transaction' | 'logging' | 'benchmark'> | undefined;\n}\n\n/**\n * The setAssociations mixin applied to models with hasMany.\n * An example of usage is as follows:\n *\n * ```typescript\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\n *   declare setRoles: HasManySetAssociationsMixin<Role, Role['id']>;\n * }\n *\n * User.hasMany(Role);\n * ```\n *\n * @see Model.hasMany\n */\nexport type HasManySetAssociationsMixin<T extends Model, TModelPrimaryKey> = (\n  newAssociations?: Iterable<T | TModelPrimaryKey> | null,\n  options?: HasManySetAssociationsMixinOptions<T>,\n) => Promise<void>;\n\n/**\n * The options for the addAssociations mixin of the hasMany association.\n *\n * @see HasManyAddAssociationsMixin\n */\nexport interface HasManyAddAssociationsMixinOptions<T extends Model>\n  extends InstanceUpdateOptions<Attributes<T>> {}\n\n/**\n * The addAssociations mixin applied to models with hasMany.\n * An example of usage is as follows:\n *\n * ```typescript\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\n *   declare addRoles: HasManyAddAssociationsMixin<Role, Role['id']>;\n * }\n *\n * User.hasMany(Role);\n * ```\n *\n * @see Model.hasMany\n */\nexport type HasManyAddAssociationsMixin<T extends Model, TModelPrimaryKey> = (\n  newAssociations?: Iterable<T | TModelPrimaryKey>,\n  options?: HasManyAddAssociationsMixinOptions<T>\n) => Promise<void>;\n\n/**\n * The options for the addAssociation mixin of the hasMany association.\n *\n * @see HasManyAddAssociationMixin\n */\nexport interface HasManyAddAssociationMixinOptions<T extends Model>\n  extends HasManyAddAssociationsMixinOptions<T> {}\n\n/**\n * The addAssociation mixin applied to models with hasMany.\n * An example of usage is as follows:\n *\n * ```typescript\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\n *   declare addRole: HasManyAddAssociationMixin<Role, Role['id']>;\n * }\n *\n * User.hasMany(Role);\n * ```\n *\n * @see Model.hasMany\n */\nexport type HasManyAddAssociationMixin<T extends Model, TModelPrimaryKey> = (\n  newAssociation?: T | TModelPrimaryKey,\n  options?: HasManyAddAssociationMixinOptions<T>\n) => Promise<void>;\n\n/**\n * The options for the createAssociation mixin of the hasMany association.\n *\n * @see HasManyCreateAssociationMixin\n */\nexport interface HasManyCreateAssociationMixinOptions<T extends Model>\n  extends CreateOptions<Attributes<T>> {}\n\n/**\n * The createAssociation mixin applied to models with hasMany.\n * An example of usage is as follows:\n *\n * ```typescript\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\n *   declare createRole: HasManyCreateAssociationMixin<Role>;\n * }\n *\n * User.hasMany(Role);\n * ```\n *\n * @see Model.hasMany\n */\nexport type HasManyCreateAssociationMixin<\n  Target extends Model,\n  ExcludedAttributes extends keyof CreationAttributes<Target> = never,\n  > = (\n  values?: Omit<CreationAttributes<Target>, ExcludedAttributes>,\n  options?: HasManyCreateAssociationMixinOptions<Target>\n) => Promise<Target>;\n\n/**\n * The options for the removeAssociation mixin of the hasMany association.\n *\n * @see HasManyRemoveAssociationMixin\n */\nexport interface HasManyRemoveAssociationMixinOptions<T extends Model>\n  extends HasManyRemoveAssociationsMixinOptions<T> {}\n\n/**\n * The removeAssociation mixin applied to models with hasMany.\n * An example of usage is as follows:\n *\n * ```typescript\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\n *   declare removeRole: HasManyRemoveAssociationMixin<Role, Role['id']>;\n * }\n *\n * User.hasMany(Role);\n * ```\n *\n * @see Model.hasMany\n */\nexport type HasManyRemoveAssociationMixin<T extends Model, TModelPrimaryKey> = (\n  oldAssociated?: T | TModelPrimaryKey,\n  options?: HasManyRemoveAssociationMixinOptions<T>\n) => Promise<void>;\n\n/**\n * The options for the removeAssociations mixin of the hasMany association.\n *\n * @see HasManyRemoveAssociationsMixin\n */\nexport interface HasManyRemoveAssociationsMixinOptions<T extends Model>\n  extends Omit<InstanceUpdateOptions<Attributes<T>>, 'where'> {\n\n  /**\n   * Delete the associated model. Default to false.\n   *\n   * Only applies if the foreign key is nullable. If the foreign key is not nullable,\n   * the associated model is always deleted.\n   */\n  destroy?: boolean | Omit<DestroyOptions<Attributes<T>>, 'where' | 'transaction' | 'logging' | 'benchmark'> | undefined;\n}\n\n/**\n * The removeAssociations mixin applied to models with hasMany.\n * An example of usage is as follows:\n *\n * ```typescript\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\n *   declare removeRoles: HasManyRemoveAssociationsMixin<Role, Role['id']>;\n * }\n *\n * User.hasMany(Role);\n * ```\n *\n * @see Model.hasMany\n */\nexport type HasManyRemoveAssociationsMixin<T extends Model, TModelPrimaryKey> = (\n  oldAssociateds?: Iterable<T | TModelPrimaryKey>,\n  options?: HasManyRemoveAssociationsMixinOptions<T>\n) => Promise<void>;\n\n/**\n * The options for the hasAssociation mixin of the hasMany association.\n *\n * @see HasManyHasAssociationMixin\n */\nexport interface HasManyHasAssociationMixinOptions<T extends Model>\n  extends HasManyGetAssociationsMixinOptions<T> {}\n\n/**\n * The hasAssociation mixin applied to models with hasMany.\n * An example of usage is as follows:\n *\n * ```typescript\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\n *   declare hasRole: HasManyHasAssociationMixin<Role, Role['id']>;\n * }\n *\n * User.hasMany(Role);\n * ```\n *\n * @see Model.hasMany\n */\nexport type HasManyHasAssociationMixin<TModel extends Model, TModelPrimaryKey> = (\n  target: TModel | TModelPrimaryKey,\n  options?: HasManyHasAssociationMixinOptions<TModel>,\n) => Promise<boolean>;\n\n/**\n * The options for the hasAssociations mixin of the hasMany association.\n *\n * @see HasManyHasAssociationsMixin\n */\nexport interface HasManyHasAssociationsMixinOptions<T extends Model>\n  extends HasManyGetAssociationsMixinOptions<T> {}\n\n/**\n * The removeAssociations mixin applied to models with hasMany.\n * An example of usage is as follows:\n *\n * ```typescript\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\n *   declare hasRoles: HasManyHasAssociationsMixin<Role, Role['id']>;\n * }\n *\n * User.hasMany(Role);\n * ```\n *\n * @see Model.hasMany\n */\n// TODO: this should be renamed to \"HasManyHasAllAssociationsMixin\",\n//       we should also add a \"HasManyHasAnyAssociationsMixin\"\n//       and \"HasManyHasAssociationsMixin\" should instead return a Map of id -> boolean or WeakMap of instance -> boolean\nexport type HasManyHasAssociationsMixin<TModel extends Model, TModelPrimaryKey> = (\n  targets: Iterable<TModel | TModelPrimaryKey>,\n  options?: HasManyHasAssociationsMixinOptions<TModel>\n) => Promise<boolean>;\n\n/**\n * The options for the countAssociations mixin of the hasMany association.\n *\n * @see HasManyCountAssociationsMixin\n */\nexport interface HasManyCountAssociationsMixinOptions<T extends Model> extends Transactionable, Filterable<Attributes<T>> {\n  /**\n   * Apply a scope on the related model, or remove its default scope by passing false.\n   */\n  scope?: string | boolean;\n}\n\n/**\n * The countAssociations mixin applied to models with hasMany.\n * An example of usage is as follows:\n *\n * ```typescript\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\n *   declare countRoles: HasManyCountAssociationsMixin<Role>;\n * }\n *\n * User.hasMany(Role);\n * ```\n *\n * @see Model.hasMany\n */\nexport type HasManyCountAssociationsMixin<T extends Model> =\n  (options?: HasManyCountAssociationsMixinOptions<T>) => Promise<number>;\n"],
  "mappings": "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",
  "names": ["upperFirst", "isObject"]
}
